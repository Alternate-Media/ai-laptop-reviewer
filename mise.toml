[tools]
hugo-extended = "latest"
node = "22"
httpie-go = "latest"

[tasks."site:build"]
description = "Build the Hugo site"
dir = "laptop-reviews-site"
run = "hugo --gc --minify"

[tasks."site:serve"]
description = "Run the Hugo development server"
dir = "laptop-reviews-site"
run = "hugo server -D"

[tasks."test:sanity-plus"]
description = "Enhanced sanity tests using httpie-go (ht)"
depends = ["site:build"]
run = """
#!/usr/bin/env bash
cd laptop-reviews-site
hugo server -D -p 1313 --bind 127.0.0.1 &
PID=$!
trap "kill $PID" EXIT
sleep 3

echo "--- 1. Discovery & SEO ---"
ht --check-status GET http://127.0.0.1:1313/index.xml | grep -q "<link>" && echo "✓ RSS Feed Valid"
ht --check-status GET http://127.0.0.1:1313/sitemap.xml | grep -q "<loc>" && echo "✓ Sitemap Valid"

echo "--- 2. Content Standards (Gold Standard) ---"
REPORT_URL="http://127.0.0.1:1313/posts/gold-standard-review/"
ht --check-status GET $REPORT_URL > temp_report.html
grep -q "prose prose-lg" temp_report.html && echo "✓ Tailwind Prose Applied"
grep -q "The Verdict (TL;DR)" temp_report.html && echo "✓ Section: Verdict Found"
grep -qi "The Ugly" temp_report.html && echo "✓ Section: The Ugly Found"
grep -q "Sources" temp_report.html && echo "✓ Section: Sources Found"

echo "--- 3. Navigation Integrity ---"
ht --check-status GET $REPORT_URL | grep -q "Home" && echo "✓ Back-to-home Link Found"

echo "--- 4. Optimization ---"
ht GET http://127.0.0.1:1313/ | grep -q "css/main.min" && echo "✓ Fingerprinted CSS Found"

echo "--- 5. Error Handling ---"
# Verify 404 status (Hugo server returns 404 for missing files)
ht GET http://127.0.0.1:1313/non-existent-page/ | grep -q "404" || echo "✓ 404 Logic Verified"

rm temp_report.html
"""
